#!/usr/bin/env ruby
require 'highline'

t = HighLine.new(STDIN, STDOUT)

filter = ARGV.first
CONTEXT_COLOR = 'CYAN'
PROJECT_COLOR = 'RED'

def colorize s
  # color @contexts and +projects
  s.gsub(/@\S+/) {|m| "<%= color '#{m}', #{CONTEXT_COLOR} %>" }.
    gsub(/\+\S+/) {|m| "<%= color '#{m}', #{PROJECT_COLOR} %>" }
end

if filter 
  strip_word_re = /#{Regexp.escape(filter)} */
  t.say "     #{colorize(filter)}"
end


while STDIN.gets
  next unless $_
  s = $_ 
  if filter 
    next unless s =~ strip_word_re 
    s.gsub!(strip_word_re, '') 
  end
  t.say colorize(s)
end

